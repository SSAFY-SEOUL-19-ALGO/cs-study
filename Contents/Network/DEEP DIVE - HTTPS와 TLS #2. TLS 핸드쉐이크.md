# DEEP DIVE : HTTPSμ™€ TLS #2. TLS ν•Έλ“μ‰μ΄ν¬

## TLS (Transport Layer Security)

- SSL(Secure Socket Layer) 1.0λ²„μ „λ¶€ν„° μ‹μ‘ν•΄μ„ SSL 2.0, SSL 3.0, TLS 1.0μ„ κ±°μΉκ³  TLS 1.3λ²„μ „κΉμ§€ μ¬λΌκ°
- SSLμ—μ„ TLSλ΅ λ…μΉ­μ΄ λ³€κ²½
- μ „μ†΅ κ³„μΈµμ—μ„ λ³΄μ•μ„ μ κ³µν•λ” ν”„λ΅ν† μ½
- ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ ν†µμ‹  ν•  λ• μ 3μκ°€ λ©”μ‹μ§€λ¥Ό λ„μ²­ν•κ±°λ‚ λ³€μ΅°ν•μ§€ λ»ν•λ„λ΅ ν•¨

## TLS Handshake (TLS 1.3)

![Untitled](https://user-images.githubusercontent.com/47595515/211579215-7ca7ef3e-616d-49c4-b5ee-c2053b4f652f.png)

1. Client Hello
    - ν΄λΌμ΄μ–ΈνΈκ°€ TLSλ²„μ „, μ•”νΈν™” μ¤μ„νΈ(Cipher Suite), λλ¤κ°’(λ¬΄μ‘μ„ λ¬Έμμ—΄), μ„μ‹ DH λ§¤κ°λ³€μλ¥Ό μ„λ²„μ— λ³΄λƒ„
2. Server Hello, EncryptedExtensions, Certificate, CertificateVerify
    - μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° λ°›μ€ μµμ…μ„ ν™•μΈ
    - μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ λ‘λ‹¤ μ§€μ›ν•λ” κ°€μ¥ λ†’μ€ TLS λ²„μ „μ„ μ‹λ³„ν•μ—¬ κ²°μ •
    - Cipher Suite μ§€μ› μ—¬λ¶€ ν™•μΈ
    - SSL μΈμ¦μ„, μ„λ²„ λλ¤κ°’, μ„μ‹ DH λ§¤κ°λ³€μλ¥Ό ν΄λΌμ΄μ–ΈνΈμ— λ³΄λƒ„
    - ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ μ„λ΅ κµν™ν• DH λ§¤κ°λ³€μλ¥Ό μ΄μ©ν•μ—¬ μ„Έμ…ν‚¤λ¥Ό μƒμ„±
3. Finished
    - μ„Έμ…ν‚¤λ¥Ό κΈ°λ°μΌλ΅ λ€μΉ­ μ•”νΈν™”λ ν†µμ‹ μ΄ μ‹μ‘ (λ³΄μ• μ„Έμ… μ‹μ‘)

<aside>
π’΅ ν‚¤κµν™ μ•κ³ λ¦¬μ¦μΌλ΅λ” λ€ν‘μ μΌλ΅ RSAμ™€ DHκ°€ μ΅΄μ¬

- RSA
    - RSAλ¥Ό μ‚¬μ©ν•  κ²½μ° SSL μΈμ¦μ„ μ•μ— μ„λ²„κ°€ μƒμ„±ν• κ³µκ°ν‚¤λ¥Ό ν¬ν•¨
    - μ·¨μ•½μ μ΄ μ΅΄μ¬ν•κΈ° λ•λ¬Έμ— TLS 1.3λ¶€ν„°λ” κ³µμ‹μ μΌλ΅ μ§€μ›ν•μ§€ μ•μ
- DH
    - ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ κ°κ° μƒμ„±ν• λ§¤κ°λ³€μλ¥Ό κµν™ν•μ—¬ ν‚¤λ¥Ό μƒμ„±
    - λ§¤κ°λ³€μλ” μ¤‘κ°„μ— λ…Έμ¶λμ–΄λ„ μƒκ΄€ μ—†μ
    - μ£Όλ΅ νƒ€μ›κ³΅μ„ μ„ μ΄μ©ν• ECDHE(Elliptic Curve Diffie-Hellman Exchange)λ¥Ό μ‚¬μ©
</aside>

## DH λ§¤κ°λ³€μ

![Untitled 1](https://user-images.githubusercontent.com/47595515/211579205-bc5786f0-d1ab-446b-832a-d6f767cdd8d1.png)

- a, bλ” Aliceμ™€ Bobλ§μ΄ μ•κ³ μλ” λΉ„λ°€κ°’
- g, pλ” κ³µκ°κ°’
- Aliceκ°€ g, p, aλ΅ λ§λ“  λ§¤κ°λ³€μ Aλ¥Ό κ³µκ°κ°’λ“¤κ³Ό ν•¨κ» Bobμ—κ² μ „μ†΅
- Bobμ€ g, p, bλ΅ λ§¤κ°λ³€μ Bλ¥Ό λ§λ“¤κ³  Aliceμ—κ² μ „μ†΅
- Aliceμ™€ Bobμ€ μ„λ΅μ—κ²μ„ λ°›μ€ λ§¤κ°λ³€μλ΅ κ³µν†µμ ν‚¤κ°’μΈ Kλ¥Ό μƒμ„± κ°€λ¥

## νƒ€μ›κ³΅μ„  μ•”νΈν™” λ°©λ²•

![Untitled 2](https://user-images.githubusercontent.com/47595515/211579207-cabf7efd-ca2a-4954-b56b-17d02018e86d.png)

- κ°μΈ ν‚¤ λ³΄μ μλ§ μ• μ μλ” νƒ€μ›κ³΅μ„ μ„ κ·Έλ¦Ό
- νƒ€μ›κ³΅μ„ μ„ κΈ°λ°μΌλ΅ κµμ°¨μ  μƒμ„±
- κµμ°¨μ μ μλ¥Ό κΈ°λ°μΌλ΅ μ•”νΈλ¥Ό μ„¤μ •ν•λ” λ°©λ²•

## Cipher Suite

- ν”„λ΅ν† μ½, AEAD Cipher Mode, Hash μ•κ³ λ¦¬μ¦μ΄ λ‚μ—΄λ κ·μ•½
- μ•”νΈμ ν’κµ°μ΄λΌκ³ λ„ λ¶λ¦¬λ©° TLS 1.3μ—λ” 5κ°κ°€ μλ‹¤
    - TLS_AES_128_GCM_SHA256
    - TLS_AES_256_GCM_SHA384
    - TLS_CHACHA20_POLY1305_SHA256
    - TLS_AES_128_CCM_SHA256
    - TLS_AES_128_CCM_8_SHA256
- TLS_AES_128_GCM_SHA256μ—λ” 3κ°€μ§€ κ·μ•½μ΄ λ“¤μ–΄ μμμ„ μλ―Έ
    - TLSλ” ν”„λ΅ν† μ½
    - AES_128_GCMμ€ AEAD Cipher Mode
    - SHA256μ€ Hash μ•κ³ λ¦¬μ¦

### AEAD Cipher Mode

- λ°μ΄ν„° μ•”νΈν™” μ•κ³ λ¦¬μ¦
- AES_128_GCMμ΄λΌλ” κ²ƒμ€ 128λΉ„νΈ ν‚¤λ¥Ό μ‚¬μ©ν•λ” AES μ•κ³ λ¦¬μ¦κ³Ό λ³‘λ ¬ κ³„μ‚°μ— μ©μ΄ν• μ•”νΈν™” μ•κ³ λ¦¬μ¦ GCMμ΄ κ²°ν•©λ μ•κ³ λ¦¬μ¦μ„ λ»ν•¨

### Hash μ•κ³ λ¦¬μ¦

- λ°μ΄ν„°λ¥Ό μ¶”μ •ν•κΈ° νλ“¤κ² λ” μ‘κ³ , μ„μ—¬ μλ” μ΅°κ°μΌλ΅ λ§λ“λ” μ•κ³ λ¦¬μ¦
- SHA-256μΈ κ²½μ° ν•΄μ‹ν•¨μμ κ²°κ³Όκ°’μ΄ 256λΉ„νΈμΈ μ•κ³ λ¦¬μ¦

  ![Untitled 3](https://user-images.githubusercontent.com/47595515/211579212-1bce5a6e-7dd6-4415-bd65-a0b32dc4e605.png)
    
- Hash μ•κ³ λ¦¬μ¦μ΄ TLSμ—μ„ μ–΄λ–»κ² μ“°μ΄λ”κ°€
    - μΈμ¦μ„κ°€ μ¬λ°”λ¥Έ μΈμ¦μ„μΈμ§€ ν™•μΈν• λ• μ‚¬μ©ν•λ” μ „μμ„λ…μ— μ‚¬μ©

      ![Untitled 4](https://user-images.githubusercontent.com/47595515/211579214-e46a5c33-b62a-472e-aa75-bff3ad46b2c2.png)
        
        1. μΈμ¦ μƒμ„±μ‘μ—… : μ „μ μ„λ…μ„ λ§λ“λ”λ° μ„λ…λλ” λ©”μ‹μ§€λ¥Ό ν•΄μ‹±
        2. μΈμ¦ ν™•μΈμ‘μ—… : λ©”μ‹μ§€λ¥Ό λ³µνΈν™”ν•΄μ„ ν•΄μ‹λ¥Ό μ„λ΅ λΉ„κµν•΄ μ¬λ°”λ¥Έ λ©”μ‹μ§€μΈμ§€ ν™•μΈ

## μΈμ¦μ„

- μ£Όμ²΄, κ³µκ°ν‚¤λ¥Ό ν¬ν•¨ν•λ” λ‹¨μν• λ°μ΄ν„° νμΌ
- μ£Όμ²΄ : μΈμ¦μ„λ¥Ό λ°κΈ‰ν• CA, λ„λ©”μΈ, μ›Ήμ‚¬μ΄νΈ μ†μ μ, μΈμ¦μ„ μ†μ μ
- μμ‹ μ΄ μ§μ ‘ SSL μΈμ¦μ„λ¥Ό λ§λ“¤ μλ„ μμ§€λ§ λ³΄ν†µμ€ μΈμ¦κΈ°κ΄€μΈ CAμ—μ„ λ°κΈ‰ν• SSL μΈμ¦μ„λ¥Ό κΈ°λ°μΌλ΅ μΈμ¦μ‘μ—… μν–‰
- μ£Όμ²΄λ” ν΄λΌμ΄μ–ΈνΈκ°€ μ ‘μ†ν• μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈκ°€ μλ„ν• μ„λ²„κ°€ λ§λ”μ§€ ν™•μΈν•  λ• μ“°μ„
- κ³µκ°ν‚¤λ” μ²μ μΈμ¦μ‘μ—…μ„ μν–‰ν•  λ• μ“°μ„

## CA (Certificate Authority)

- μΈμ¦μ„λ¥Ό λ°κΈ‰ν•λ” κΈ°μ—…λ“¤
- μ„λΉ„μ¤μ λ„λ©”μΈ, κ³µκ°ν‚¤μ™€ κ°™μ€ μ •λ³΄λ¥Ό μ„λΉ„μ¤κ°€ CAλ΅λ¶€ν„° μΈμ¦μ„λ¥Ό κµ¬μ…ν•  λ• μ μ¶ν•΄μ•Όν•¨
- λ‹¤μ–‘ν• μ ν•μ μΈμ¦μ„κ°€ μ΅΄μ¬

    ![CA](https://user-images.githubusercontent.com/47595515/211579218-e68c7c97-23fe-42fa-aba8-73dcace37d66.PNG)
    
    - λ‹¨μΌ λ„λ©”μΈ : λ‹¨ ν•λ‚μ λ„λ©”μΈμ— μ μ©λλ” μΈμ¦μ„
    - μ™€μΌλ“μΉ΄λ“ : λ„λ©”μΈμ ν•μ„ λ„λ©”μΈλ„ ν¬ν•¨ν•λ” μΈμ¦μ„
    - λ©€ν‹° λ„λ©”μΈ : κ΄€λ ¨λμ§€ μ•μ€ λ‹¤μμ λ„λ©”μΈμ— μ μ©λ  μ μλ” μΈμ¦μ„

## RSAμ μ·¨μ•½μ 

- RSA ν‚¤ κµν™ κ³Όμ •
    
    <img width="1047" alt="RSA" src="https://user-images.githubusercontent.com/47595515/211579220-11fd5bab-6fd5-4fc6-b571-67f101b502f0.PNG">
    
    - μ„λ²„μ—μ„ κ³µκ°ν‚¤μ™€ κ°μΈν‚¤λ¥Ό μƒμ„±ν•κ³  SSLμΈμ¦μ„λ¥Ό ν†µν•΄ κ³µκ°ν‚¤λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² μ „μ†΅
    - ν΄λΌμ΄μ–ΈνΈλ” κ³µκ°ν‚¤λ΅ μ„Έμ…ν‚¤λ¥Ό μ•”νΈν™” ν•μ—¬ μ„λ²„μ— μ „μ†΅
    - μ„λ²„λ” μ„Έμ…ν‚¤λ¥Ό λ³µνΈν™” ν•μ—¬ ν†µμ‹ μ— μ‚¬μ©
- PFS(Perfect Forward Secrecy)λ¥Ό μ§€μ›ν•μ§€ μ•μ
    - μ 3μκ°€ μ„λ²„μ κ°μΈν‚¤κ°€ νƒμ·¨ν•  κ²½μ° SSL Handshake κ³Όμ •μ λ¨λ“  λ°μ΄ν„°λ¥Ό λ³µνΈν™” ν•μ—¬ λ³Ό μ μλ‹¤
    - ECDHE λ°©μ‹μ΄ PFSλ¥Ό μ§€μ›
        - DH λ°©μ‹μ€ μ„Έμ…ν‚¤λ¥Ό μ•μ „ν•κ³  κ°„λ‹¨ν•κ² μƒμ„±κ°€λ¥ν•κΈ° λ•λ¬Έμ— μ£ΌκΈ°μ μΌλ΅ μ„Έμ…ν‚¤λ¥Ό λ³€κ²½ν•μ—¬ μΌμ •μ£ΌκΈ°λ§λ‹¤ λ‹¤λ¥Έ μ„Έμ…ν‚¤λ¥Ό κ°€μ§
        - κ³µκ²©μκ°€ νΉμ • μ‹μ μ λ°μ΄ν„°λ¥Ό λ³µνΈν™”ν•κ³  μ‹¶μ„ κ²½μ° νΉμ •μ‹μ μ μ„Έμ…ν‚¤κ°€ μμ–΄μ•Ό ν•¨

## 0-RTT

- μ„Έμ…ν‚¤κ°€ μƒμ„±λ μ΄ν›„ κ·Έ μ‚¬μ΄νΈλ¥Ό μ¬λ°©λ¬Έν•λ‹¤λ©΄ λ―Έλ¦¬ λ§λ“¤μ–΄ λ†“μ€ μ„Έμ…ν‚¤(PSK, Pre-Shared Key)λ¥Ό κΈ°λ°μΌλ΅ μ—°κ²°μ„ μƒμ„±ν•κΈ° λ•λ¬Έμ— μΈμ¦μ— λ“λ” λΉ„μ©μ΄ μ—†λ‹¤

    <img width="913" alt="0-RTT" src="https://user-images.githubusercontent.com/47595515/211579194-6b6c704d-f6b5-46f3-bbe6-da34dcb8b1a1.PNG">
    
- λ―Όκ°ν• κΈμµμ •λ³΄λ¥Ό λ‹¤λ£¨λ”λ° μ΄μ μ΄ μκ³  HTTP/2λ¥Ό κµ¬ν„ν•  μ μλ‹¤
    - HTTP/2λ” HTTPSμ„μ—μ„λ§ λμ•„κ°„λ‹¤